<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title | default: site.title | escape }}</title>
    <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700;800&family=Inter:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS CDN for quick prototyping -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Custom animations and styles */
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(5deg); }
            50% { transform: translateY(0px) rotate(10deg); }
            75% { transform: translateY(5px) rotate(15deg); }
        }
        
        @keyframes scanlines {
            0% { background-position: 0 0; }
            100% { background-position: 0 40px; }
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; transform: scale(1) rotate(var(--rotation, 0deg)); }
            100% { opacity: 0; transform: scale(0.8) rotate(var(--rotation, 0deg)); }
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; transform: scale(0.8) rotate(var(--rotation, 0deg)); }
            100% { opacity: 1; transform: scale(1) rotate(var(--rotation, 0deg)); }
        }
        
        .glitch {
            animation: glitch 1s infinite;
        }
        
        .float {
            animation: float 4s ease-in-out infinite;
        }
        
        .noise-overlay {
            background: repeating-linear-gradient(
                0deg,
                rgba(255,255,255,.04) 0px,
                rgba(255,255,255,.04) 1px,
                transparent 1px,
                transparent 2px
            );
            animation: scanlines 2s infinite linear;
        }
        
        .drag-element {
            cursor: grab;
            user-select: none;
        }
        
        .drag-element:active {
            cursor: grabbing;
        }
        
        .window-chrome {
            box-shadow: 12px 12px 0 0 #000;
        }
        
        .brutal-shadow {
            box-shadow: 6px 6px 0 0 #000;
        }
        
        .selection\\:bg-black::selection {
            background: #000;
            color: #fff;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 12px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border: 2px solid #000;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #000;
            border: 2px solid #fff;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
    </style>
</head>
<body class="min-h-screen bg-white text-black overflow-hidden selection:bg-black selection:text-white">
    
    <!-- Noise Overlay -->
    <div class="noise-overlay pointer-events-none fixed inset-0 mix-blend-overlay opacity-20 z-10"></div>
    
    <!-- Crop Mark -->
    <div class="fixed left-3 top-3 w-10 h-10 border-2 border-black rounded-full opacity-40 z-20"></div>
    
    <!-- Header -->
    <header class="sticky top-0 z-[1000] border-b-4 border-black bg-white/90 backdrop-blur px-4 md:px-8 py-3 flex items-center justify-between">
        <div class="uppercase text-2xl tracking-widest font-black">
            <a href="{{ '/' | relative_url }}">{{ site.title | default: "BLOG" }}</a>
        </div>
        <nav class="flex items-center gap-2">
            <button id="search-btn" class="border-4 border-black px-3 py-1 brutal-shadow hover:bg-gray-100 transition-colors">Search</button>
            <button id="randomize-btn" class="border-4 border-black px-3 py-1 brutal-shadow hover:bg-gray-100 transition-colors">Randomize</button>
            <button id="restore-btn" class="border-4 border-black px-3 py-1 bg-green-200 brutal-shadow hover:bg-green-300 transition-colors">Restore</button>
            <button id="glitch-btn" class="border-4 border-black px-3 py-1 bg-pink-200 brutal-shadow hover:bg-pink-300 transition-colors">Glitch Mode</button>
        </nav>
    </header>
    
    <main class="relative min-h-[70vh]">
        <!-- Underlay grid of posts -->
        <div class="mx-auto max-w-7xl px-4 md:px-8 grid md:grid-cols-3 gap-6 pt-10 pb-32">
            {% for post in site.posts limit:6 %}
            <div class="relative border-4 border-black bg-white p-4 brutal-shadow rotate-[-0.6deg] hover:rotate-[1deg] transition-transform duration-300">
                <h3 class="font-mono text-xl md:text-2xl mb-2 underline decoration-dotted">
                    <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
                </h3>
                <p class="text-sm leading-5 font-mono">{{ post.excerpt | strip_html | truncate: 120 }}</p>
                <div class="mt-2 text-xs text-gray-600">
                    {{ post.date | date: "%Y.%m.%d" }}
                    {% if post.categories.size > 0 %}
                    • {{ post.categories | join: ", " }}
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Floating image windows container -->
        <div id="floating-windows"></div>
        
        <!-- Text window -->
        <div id="text-window" class="drag-element absolute border-4 border-black bg-white window-chrome" style="width: 380px; height: 220px; top: 100px; left: 50px; z-index: 800;">
            <div class="flex items-center justify-between border-b-4 border-black bg-gray-100 px-2 py-1">
                <div class="flex gap-1">
                    <div onclick="document.getElementById('text-window').style.display='none'" class="w-3 h-3 bg-black animate-ping cursor-pointer hover:bg-red-500 transition-colors"></div>
                    <div class="w-3 h-3 border-2 border-black"></div>
                    <div class="w-3 h-3 bg-white border-2 border-black -rotate-45"></div>
                </div>
                <span class="text-[10px] uppercase tracking-widest">window</span>
            </div>
            <div class="p-4 text-[12px] leading-5">
                <h3 class="font-bold mb-2 italic underline decoration-wavy decoration-pink-500">{{ site.author | default: "Hello visitor" }}, how are you?</h3>
                <p class="whitespace-pre-wrap font-mono leading-relaxed">{{ site.description | default: "Hey! Doing well—this site is always in progress. It breaks, it learns, it keeps the theatre open." }}</p>
            </div>
        </div>
        
        <!-- Draggable badge -->
        <div id="badge" class="drag-element absolute left-6 bottom-6 z-[900] bg-white border-4 border-black p-3 w-44 brutal-shadow rotate-[0.8deg]">
            <button onclick="document.getElementById('badge').style.display='none'" class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 border-2 border-black text-white text-xs font-bold leading-none hover:bg-red-600 transition-colors rounded-full">×</button>
            <div class="text-[10px] mb-1">ID: {{ site.author | upcase | default: "FACULTY" }} / ISSUED: TODAY</div>
            <div class="text-lg font-black">THE PRESIDENT</div>
            <div class="h-20 mt-2 bg-gray-300 border-2 border-black flex items-center justify-center text-xs">
                PORTRAIT
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="relative border-t-4 border-black bg-gray-100">
        <div class="mx-auto max-w-7xl px-4 md:px-8 py-12 grid md:grid-cols-2 gap-10">
            <div id="about">
                <h4 class="font-black text-3xl mb-2">About</h4>
                <p class="font-mono text-sm leading-6">
                    {{ site.description | default: "A neo-brutalist blog built with Jekyll. Images and elements move around while new notes drop in." }}
                </p>
            </div>
            <div id="contact" class="text-right md:text-left">
                <h4 class="font-black text-3xl mb-2">Contact</h4>
                <ul class="space-y-2 text-sm">
                    {% if site.email %}
                    <li><a class="underline" href="mailto:{{ site.email }}">{{ site.email }}</a></li>
                    {% endif %}
                    {% for item in site.data.contact %}
                    <li><a class="underline" href="{{ item.url }}" target="_blank">{{ item.type }} / {{ item.name }}</a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="fixed right-6 bottom-4 text-sm">
            <a class="underline mr-3" href="#about">About</a>
            <a class="underline" href="#contact">Contact</a>
        </div>
    </footer>
    
    <!-- Search Modal -->
    <div id="search-modal" class="fixed inset-0 z-[2000] bg-white/95 backdrop-blur flex items-center justify-center hidden">
        <div class="relative border-4 border-black bg-white p-6 window-chrome max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden flex flex-col">
            <button id="close-search" class="absolute -top-3 -right-3 bg-black text-white text-xs px-2 py-1 border-2 border-black hover:bg-red-500 transition-colors">X</button>
            <div class="text-center mb-4">
                <div class="text-2xl font-black tracking-widest mb-4">SEARCH</div>
                <input type="text" id="search-input" placeholder="제목, 내용, 카테고리, 태그로 검색..." class="border-4 border-black p-3 w-full font-mono text-left" autofocus>
            </div>
        </div>
    </div>
    
    <!-- Global CHAOS button - Always visible -->
    <div id="global-chaos-btn" class="fixed bottom-8 right-8 w-16 h-16 border-4 border-black bg-pink-200 cursor-pointer brutal-shadow hover:bg-pink-300 transition-colors flex items-center justify-center font-mono font-bold text-xs rotate-12 z-[1500]">
        CHAOS
    </div>
    
    <script>
        // Global state
        let glitchMode = localStorage.getItem('chaos-mode') === 'true';
        let chaosMode = localStorage.getItem('chaos-mode') === 'true';
        let windowCount = 2; // 기본값, imageConfig에서 초기화됨
        let dragElements = [];
        let chaosInterval = null;
        
        // Image sources configuration - 이곳에서 이미지를 제어할 수 있습니다
        const imageConfig = {
            // 기본 이미지 개수
            defaultCount: 2,
            
            // 사용할 이미지 소스들 (assets/img/floating/ 폴더의 이미지들)
            sources: [
                '{{ "/assets/img/floating/sample1.svg" | relative_url }}?v={{ site.time | date: '%s' }}',
                '{{ "/assets/img/floating/sample2.svg" | relative_url }}?v={{ site.time | date: '%s' }}',
                '{{ "/assets/img/floating/sample3.svg" | relative_url }}?v={{ site.time | date: '%s' }}'
            ],
            
            // 창 크기 범위
            width: { min: 280, max: 460 },
            height: { min: 180, max: 320 },
            
            // 회전 범위 (도)
            rotation: { min: -7, max: 7 }
        };
        
        
        // Utility functions
        function rand(min, max) {
            return Math.random() * (max - min) + min;
        }
        
        function shuffle(arr) {
            return [...arr].sort(() => Math.random() - 0.5);
        }
        
        // Create floating image window
        function createImageWindow(src, index) {
            const window = document.createElement('div');
            window.className = `drag-element absolute border-4 border-black bg-white window-chrome ${glitchMode && index % 2 === 0 ? 'glitch' : ''}`;
            window.style.width = rand(imageConfig.width.min, imageConfig.width.max) + 'px';
            window.style.height = rand(imageConfig.height.min, imageConfig.height.max) + 'px';
            window.style.left = rand(30, Math.max(100, window.innerWidth - 500)) + 'px';
            window.style.top = rand(30, Math.max(100, window.innerHeight - 400)) + 'px';
            window.style.zIndex = 200 + index;
            window.style.transform = `rotate(${rand(imageConfig.rotation.min, imageConfig.rotation.max)}deg)`;
            window.setAttribute('data-window-id', `window-${index}`);
            
            window.innerHTML = `
                <div class="flex items-center justify-between border-b-4 border-black bg-gray-100 px-2 py-1">
                    <div class="flex gap-1">
                        <div class="close-dot-btn w-3 h-3 bg-black animate-ping cursor-pointer hover:bg-red-500 transition-colors"></div>
                        <div class="w-3 h-3 border-2 border-black"></div>
                        <div class="w-3 h-3 bg-white border-2 border-black -rotate-45"></div>
                    </div>
                    <span class="text-[10px] uppercase tracking-widest">window</span>
                </div>
                <img src="${src}" alt="" class="w-full h-full object-cover ${glitchMode && index % 2 === 0 ? 'mix-blend-screen' : ''}">
            `;
            
            // Add close functionality for blinking dot only
            const closeWindow = (e) => {
                e.stopPropagation(); // Prevent drag from triggering
                window.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => {
                    window.remove();
                    // Update dragElements array
                    dragElements = dragElements.filter(el => el !== window);
                }, 300);
            };
            
            const closeDot = window.querySelector('.close-dot-btn');
            closeDot.addEventListener('click', closeWindow);
            
            return window;
        }
        
        // Generate floating windows
        function generateWindows() {
            const container = document.getElementById('floating-windows');
            container.innerHTML = '';
            
            const shuffledImages = shuffle(imageConfig.sources);
            
            for (let i = 0; i < windowCount; i++) {
                const window = createImageWindow(shuffledImages[i % shuffledImages.length], i);
                container.appendChild(window);
            }
            
            initializeDraggables();
        }
        
        // Make elements draggable
        function initializeDraggables() {
            dragElements = document.querySelectorAll('.drag-element');
            
            dragElements.forEach(element => {
                let isDragging = false;
                let currentX;
                let currentY;
                let initialX;
                let initialY;
                let xOffset = 0;
                let yOffset = 0;
                
                function setTranslate(xPos, yPos, el) {
                    const currentTransform = el.style.transform || '';
                    const rotateMatch = currentTransform.match(/rotate\\([^)]+\\)/);
                    const rotateStr = rotateMatch ? rotateMatch[0] : '';
                    
                    el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0) ${rotateStr}`;
                }
                
                function dragStart(e) {
                    if (e.type === 'touchstart') {
                        initialX = e.touches[0].clientX - xOffset;
                        initialY = e.touches[0].clientY - yOffset;
                    } else {
                        initialX = e.clientX - xOffset;
                        initialY = e.clientY - yOffset;
                    }
                    
                    if (e.target === element || element.contains(e.target)) {
                        isDragging = true;
                        element.style.zIndex = 1000;
                    }
                }
                
                function dragEnd(e) {
                    initialX = currentX;
                    initialY = currentY;
                    isDragging = false;
                    element.style.zIndex = '';
                }
                
                function drag(e) {
                    if (isDragging) {
                        e.preventDefault();
                        
                        if (e.type === 'touchmove') {
                            currentX = e.touches[0].clientX - initialX;
                            currentY = e.touches[0].clientY - initialY;
                        } else {
                            currentX = e.clientX - initialX;
                            currentY = e.clientY - initialY;
                        }
                        
                        xOffset = currentX;
                        yOffset = currentY;
                        
                        setTranslate(currentX, currentY, element);
                    }
                }
                
                // Mouse events
                element.addEventListener('mousedown', dragStart, false);
                document.addEventListener('mouseup', dragEnd, false);
                document.addEventListener('mousemove', drag, false);
                
                // Touch events
                element.addEventListener('touchstart', dragStart, false);
                document.addEventListener('touchend', dragEnd, false);
                document.addEventListener('touchmove', drag, false);
            });
        }
        
        // Event listeners
        document.getElementById('search-btn').addEventListener('click', () => {
            document.getElementById('search-modal').classList.remove('hidden');
        });
        
        document.getElementById('close-search').addEventListener('click', () => {
            document.getElementById('search-modal').classList.add('hidden');
        });
        
        document.getElementById('randomize-btn').addEventListener('click', () => {
            windowCount = windowCount >= 12 ? 5 : windowCount + 1;
            generateWindows();
        });
        
        document.getElementById('restore-btn').addEventListener('click', () => {
            // Restore text window
            const textWindow = document.getElementById('text-window');
            if (textWindow) {
                textWindow.style.display = 'block';
                textWindow.style.animation = 'fadeIn 0.3s ease-in';
            }
            
            // Restore badge
            const badge = document.getElementById('badge');
            if (badge) {
                badge.style.display = 'block';
                badge.style.animation = 'fadeIn 0.3s ease-in';
            }
            
            // Reset window count to default and regenerate
            windowCount = imageConfig.defaultCount;
            generateWindows();
        });
        
        // CHAOS mode toggle function
        function toggleChaosMode() {
            chaosMode = !chaosMode;
            glitchMode = chaosMode; // Glitch is part of chaos
            
            // Save to localStorage
            localStorage.setItem('chaos-mode', chaosMode.toString());
            
            // Update header button
            const btn = document.getElementById('glitch-btn');
            if (btn) {
                btn.textContent = chaosMode ? 'STOP CHAOS' : 'Glitch Mode';
                btn.style.background = chaosMode ? '#ff0080' : '#ffc0cb';
            }
            
            // Update global CHAOS button
            const globalBtn = document.getElementById('global-chaos-btn');
            if (globalBtn) {
                globalBtn.textContent = chaosMode ? 'STOP' : 'CHAOS';
                globalBtn.style.background = chaosMode ? '#ff0080' : '#ffc0cb';
            }
            
            if (chaosMode) {
                document.body.classList.add('glitch');
                
                // Continuous chaos mode
                chaosInterval = setInterval(() => {
                    // Randomly change window count
                    if (document.getElementById('floating-windows')) {
                        windowCount = Math.floor(rand(3, 15));
                        generateWindows();
                    }
                    
                    // Random glitch effects
                    if (Math.random() < 0.3) {
                        document.body.style.filter = `hue-rotate(${rand(0, 360)}deg) saturate(${rand(0.5, 2)})`;
                        setTimeout(() => {
                            document.body.style.filter = '';
                        }, 200);
                    }
                    
                    // Randomly move existing windows
                    const existingWindows = document.querySelectorAll('#floating-windows .drag-element');
                    existingWindows.forEach(window => {
                        if (Math.random() < 0.4) {
                            window.style.left = rand(0, window.innerWidth - 300) + 'px';
                            window.style.top = rand(0, window.innerHeight - 200) + 'px';
                            window.style.transform = `rotate(${rand(-15, 15)}deg)`;
                        }
                    });
                    
                }, rand(800, 2000));
                
            } else {
                document.body.classList.remove('glitch');
                document.body.style.filter = '';
                if (chaosInterval) {
                    clearInterval(chaosInterval);
                    chaosInterval = null;
                }
            }
            
            if (typeof generateWindows === 'function') {
                generateWindows();
            }
        }
        
        document.getElementById('glitch-btn').addEventListener('click', toggleChaosMode);
        
        // Global CHAOS button
        document.getElementById('global-chaos-btn').addEventListener('click', toggleChaosMode);
        
        // Search functionality
        let searchData = null;
        
        // Load search data
        async function loadSearchData() {
            try {
                const response = await fetch('{{ "/assets/js/search-data.json" | relative_url }}?v={{ site.time | date: '%s' }}');
                searchData = await response.json();
            } catch (error) {
                console.error('Failed to load search data:', error);
            }
        }
        
        // Search function
        function performSearch(query) {
            if (!searchData || query.length < 2) {
                return [];
            }
            
            query = query.toLowerCase();
            
            return searchData.posts.filter(post => {
                return post.title.toLowerCase().includes(query) ||
                       post.content.toLowerCase().includes(query) ||
                       post.categories.some(cat => cat.toLowerCase().includes(query)) ||
                       post.tags.some(tag => tag.toLowerCase().includes(query));
            }).slice(0, 10); // Limit to 10 results
        }
        
        // Display search results
        function displaySearchResults(results, query) {
            const modal = document.getElementById('search-modal');
            const existingResults = modal.querySelector('.search-results');
            if (existingResults) {
                existingResults.remove();
            }
            
            if (results.length === 0 && query.length >= 2) {
                const noResults = document.createElement('div');
                noResults.className = 'search-results mt-4 p-4 border-4 border-black bg-gray-100';
                noResults.innerHTML = '<p class="font-mono text-center">검색 결과가 없습니다.</p>';
                modal.querySelector('.relative').appendChild(noResults);
                return;
            }
            
            if (results.length > 0) {
                const resultsDiv = document.createElement('div');
                resultsDiv.className = 'search-results mt-4 max-h-96 overflow-y-auto';
                
                results.forEach(post => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'border-4 border-black bg-white p-3 mb-2 brutal-shadow hover:bg-gray-50 cursor-pointer';
                    resultItem.innerHTML = `
                        <h3 class="font-bold text-lg mb-1">${post.title}</h3>
                        <p class="text-sm text-gray-600 mb-2">${post.date} • ${post.categories.join(', ')}</p>
                        <p class="text-sm">${post.excerpt.substring(0, 150)}...</p>
                    `;
                    
                    resultItem.addEventListener('click', () => {
                        window.location.href = post.url;
                    });
                    
                    resultsDiv.appendChild(resultItem);
                });
                
                modal.querySelector('.relative').appendChild(resultsDiv);
            }
        }
        
        document.getElementById('search-input').addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const results = performSearch(query);
            displaySearchResults(results, query);
        });
        
        // Close search on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.getElementById('search-modal').classList.add('hidden');
            }
        });
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            // 기본 창 개수 설정
            windowCount = imageConfig.defaultCount;
            generateWindows();
            
            // Add initial draggable functionality to static elements
            initializeDraggables();
            
            // Initial mobile optimization
            optimizeForMobile();
            
            // Load search data
            loadSearchData();
            
            // Initialize CHAOS mode if it was previously active
            if (chaosMode) {
                const btn = document.getElementById('glitch-btn');
                if (btn) {
                    btn.textContent = 'STOP CHAOS';
                    btn.style.background = '#ff0080';
                }
                
                const globalBtn = document.getElementById('global-chaos-btn');
                if (globalBtn) {
                    globalBtn.textContent = 'STOP';
                    globalBtn.style.background = '#ff0080';
                }
                
                document.body.classList.add('glitch');
                
                // Start chaos interval
                chaosInterval = setInterval(() => {
                    if (document.getElementById('floating-windows')) {
                        windowCount = Math.floor(rand(3, 15));
                        generateWindows();
                    }
                    
                    if (Math.random() < 0.3) {
                        document.body.style.filter = `hue-rotate(${rand(0, 360)}deg) saturate(${rand(0.5, 2)})`;
                        setTimeout(() => {
                            document.body.style.filter = '';
                        }, 200);
                    }
                    
                    const existingWindows = document.querySelectorAll('#floating-windows .drag-element');
                    existingWindows.forEach(window => {
                        if (Math.random() < 0.4) {
                            window.style.left = rand(0, window.innerWidth - 300) + 'px';
                            window.style.top = rand(0, window.innerHeight - 200) + 'px';
                            window.style.transform = `rotate(${rand(-15, 15)}deg)`;
                        }
                    });
                }, rand(800, 2000));
            }
        });
        
        // Mobile optimizations
        function optimizeForMobile() {
            const isMobile = window.innerWidth < 768;
            
            if (isMobile) {
                // Reduce number of windows on mobile
                windowCount = Math.min(windowCount, 3);
                
                // Make windows smaller on mobile
                const mobileWindows = document.querySelectorAll('#floating-windows .drag-element');
                mobileWindows.forEach(window => {
                    window.style.width = '200px';
                    window.style.height = '150px';
                });
                
                // Hide some decorative elements on very small screens
                if (window.innerWidth < 480) {
                    const textWindow = document.getElementById('text-window');
                    const badge = document.getElementById('badge');
                    if (textWindow) textWindow.style.display = 'none';
                    if (badge) badge.style.display = 'none';
                }
            } else {
                // Show elements on larger screens
                const textWindow = document.getElementById('text-window');
                const badge = document.getElementById('badge');
                if (textWindow) textWindow.style.display = 'block';
                if (badge) badge.style.display = 'block';
            }
        }
        
        // Responsive behavior
        window.addEventListener('resize', () => {
            // Reposition windows if they're off-screen
            dragElements.forEach(element => {
                const rect = element.getBoundingClientRect();
                if (rect.right > window.innerWidth || rect.bottom > window.innerHeight) {
                    element.style.left = Math.min(element.offsetLeft, window.innerWidth - element.offsetWidth) + 'px';
                    element.style.top = Math.min(element.offsetTop, window.innerHeight - element.offsetHeight) + 'px';
                }
            });
            
            optimizeForMobile();
        });
        
    </script>
</body>
</html>